<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ludo Supreme - Direct Play</title>
    <style>
        :root { --red: #ff4757; --blue: #1e90ff; --green: #2ed573; --yellow: #ffa502; --bg: #0f172a; }
        body { font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 100vh; background: var(--bg); color: white; margin: 0; overflow: hidden; }
        
        .status-card { text-align:center; font-size: 1.2rem; margin-bottom: 8px; font-weight: 900; color: var(--red); }
        .board { display: grid; grid-template-columns: repeat(15, min(6vw, 32px)); grid-template-rows: repeat(15, min(6vw, 32px)); background: #f8fafc; border: 6px solid #334155; border-radius: 8px; position: relative; }
        .cell { border: 0.1px solid #cbd5e1; display: flex; align-items: center; justify-content: center; }
        .base { grid-column: span 6; grid-row: span 6; display: grid; grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(2, 1fr); gap: 4px; padding: 8px; }
        .red-base { background: var(--red); grid-area: 1/1/7/7; }
        .blue-base { background: var(--blue); grid-area: 1/10/7/16; }
        .green-base { background: var(--green); grid-area: 10/10/16/16; }
        .yellow-base { background: var(--yellow); grid-area: 10/1/16/7; }
        .slot { background: rgba(255,255,255,0.4); border-radius: 50%; width: 80%; height: 80%; margin: auto; display: flex; align-items: center; justify-content: center; }
        .piece { width: 85%; height: 85%; border-radius: 50%; border: 2px solid rgba(0,0,0,0.2); cursor: pointer; z-index: 100; transition: transform 0.2s; }
        .red { background: #ff0000; } .blue { background: #0000ff; } .green { background: #00ff00; } .yellow { background: #ffff00; }
        .selectable { animation: pulse 0.6s infinite alternate; border: 2px solid white; box-shadow: 0 0 10px white; }
        @keyframes pulse { from { transform: scale(1); } to { transform: scale(1.2); } }
        .dice { grid-area: 7/7/10/10; z-index: 500; background: white; color: black; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; cursor: pointer; border: 3px solid #334155; border-radius: 8px; }
        .shake { animation: shake 0.1s infinite; }
        @keyframes shake { 0% { transform: translate(2px, 2px); } 50% { transform: translate(-2px, -2px); } }
        .btn { padding: 10px 20px; background: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; color: black; }
    </style>
</head>
<body>

    <div id="status" class="status-card">RED'S TURN</div>

    <div class="board" id="board">
        <div class="base red-base" id="base-red"></div>
        <div class="base blue-base" id="base-blue"></div>
        <div class="base green-base" id="base-green"></div>
        <div class="base yellow-base" id="base-yellow"></div>
        <div class="dice" id="dice" onclick="roll()">ðŸŽ²</div>
    </div>

    <div style="margin-top:15px; display: flex; gap: 10px;">
        <button class="btn" onclick="toggleMute()">ðŸŽµ Music</button>
        <button class="btn" onclick="location.reload()">ðŸ”„ Reset</button>
    </div>

<script>
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    let musicOn = true, currentPlayer = 0, diceVal = 0, rolling = false, musicStarted = false;
    const colors = ['red', 'blue', 'green', 'yellow'];
    const state = {};

    function playSFX(f, d, type='sine', vol=0.2) {
        if(!musicOn) return;
        const o = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        o.type = type; o.frequency.setValueAtTime(f, audioCtx.currentTime);
        g.gain.setValueAtTime(vol, audioCtx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + d);
        o.connect(g); g.connect(audioCtx.destination);
        o.start(); o.stop(audioCtx.currentTime + d);
    }

    function playSixJingle() {
        [523, 659, 783, 1046].forEach((f, i) => setTimeout(() => playSFX(f, 0.5, 'triangle', 0.15), i * 120));
    }

    function startPopMusic() {
        if (musicStarted) return;
        musicStarted = true;
        const sequence = [261, 329, 392, 523];
        let step = 0;
        setInterval(() => {
            if (!musicOn) return;
            playSFX(sequence[step], 0.6, 'sine', 0.03);
            step = (step + 1) % sequence.length;
        }, 500);
    }

    const PATH = [[6,1],[6,2],[6,3],[6,4],[6,5],[5,6],[4,6],[3,6],[2,6],[1,6],[0,6],[0,7],[0,8],[1,8],[2,8],[3,8],[4,8],[5,8],[6,9],[6,10],[6,11],[6,12],[6,13],[6,14],[7,14],[8,14],[8,13],[8,12],[8,11],[8,10],[8,9],[9,8],[10,8],[11,8],[12,8],[13,8],[14,8],[14,7],[14,6],[13,6],[12,6],[11,6],[10,6],[9,6],[8,5],[8,4],[8,3],[8,2],[8,1],[8,0],[7,0],[6,0]];
    const STARTS = { red: 0, blue: 13, green: 26, yellow: 39 };

    function initBoard() {
        colors.forEach(c => {
            state[c] = Array(5).fill().map(() => ({ home: true, pos: -1 }));
            const base = document.getElementById('base-'+c);
            base.innerHTML = '';
            for(let i=0; i<6; i++) {
                const s = document.createElement('div'); s.className = 'slot';
                if(i < 5) s.id = `slot-${c}-${i}`; else s.style.visibility = 'hidden';
                base.appendChild(s);
            }
        });
        const board = document.getElementById('board');
        for(let r=0; r<15; r++) {
            for(let c=0; c<15; c++) {
                if((r<6&&c<6)||(r<6&&c>8)||(r>8&&c>8)||(r>8&&c<6)||(r>=6&&r<=8&&c>=6&&c<=8)) continue;
                const cell = document.createElement('div'); cell.className = 'cell';
                cell.id = `c-${r}-${c}`; cell.style.gridArea = `${r+1}/${c+1}`;
                board.appendChild(cell);
            }
        }
        render();
    }

    function render() {
        document.querySelectorAll('.piece').forEach(p => p.remove());
        colors.forEach(color => {
            state[color].forEach((p, i) => {
                const el = document.createElement('div'); el.className = `piece ${color}`;
                el.onclick = (e) => { e.stopPropagation(); move(color, i); };
                if(p.home) document.getElementById(`slot-${color}-${i}`).appendChild(el);
                else {
                    const coord = PATH[(STARTS[color] + p.pos) % 52];
                    document.getElementById(`c-${coord[0]}-${coord[1]}`).appendChild(el);
                }
            });
        });
    }

    function roll() {
        if(rolling) return;
        if (audioCtx.state === 'suspended') audioCtx.resume().then(startPopMusic);
        else startPopMusic();

        const diceEl = document.getElementById('dice');
        diceEl.classList.add('shake');
        playSFX(120, 0.2, 'square', 0.15);
        
        setTimeout(() => {
            diceEl.classList.remove('shake');
            diceVal = Math.floor(Math.random()*6)+1;
            diceEl.textContent = diceVal;
            if(diceVal === 6) playSixJingle();
            const c = colors[currentPlayer];
            if(!state[c].some(p => p.home ? diceVal===6 : p.pos+diceVal <= 57)) setTimeout(next, 800);
            else { rolling = true; document.querySelectorAll('.'+c).forEach((el, i) => {
                if(state[c][i].home ? diceVal===6 : state[c][i].pos+diceVal <= 57) el.classList.add('selectable');
            }); }
        }, 500);
    }

    function move(color, i) {
        if(!rolling || color !== colors[currentPlayer]) return;
        const p = state[color][i];
        if(p.home && diceVal === 6) { p.home = false; p.pos = 0; playSFX(880, 0.2); }
        else if(!p.home && p.pos+diceVal <= 57) { p.pos += diceVal; playSFX(440, 0.1); }
        else return;
        rolling = false; render();
        if(diceVal === 6) document.getElementById('dice').textContent = 'ðŸŽ²'; else next();
    }

    function next() {
        currentPlayer = (currentPlayer+1)%4; rolling = false;
        const s = document.getElementById('status');
        s.textContent = colors[currentPlayer].toUpperCase() + "'S TURN";
        s.style.color = `var(--${colors[currentPlayer]})`;
        document.getElementById('dice').textContent = 'ðŸŽ²';
    }

    function toggleMute() { musicOn = !musicOn; }
    initBoard();
</script>
</body>
</html>

